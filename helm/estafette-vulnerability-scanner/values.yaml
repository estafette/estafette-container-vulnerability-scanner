# Default values for estafette-vulnerability-scanner.
# This is a YAML-formatted file.
# Declare variables to be passed into your templates.

#
# APPLICATION SETTINGS
#

# set an image pull secret to avoid Docker Hub rate limiting issues
imagePullSecret: {}
#  registryURL: https://index.docker.io/v1/
#  username: testUser
#  password: testPassword

# the following log formats are available: plaintext, console, json, stackdriver, v3 (see https://github.com/estafette/estafette-foundation for more info)
logFormat: plaintext

# the following levels and upwards will be logged: disabled, trace, debug, info, warn, error, fatal, panic (see https://github.com/estafette/estafette-foundation for more info)
logLevel: debug

#
# GENERIC SETTINGS
#

replicaCount: 1

image:
  repository: fr33ky/estafette-vulnerability-scanner
  # The tag can be set to override the appVersion getting used as the image tag
  tag: 0.1.17-airgap-0.22.0
  pullPolicy: IfNotPresent

nameOverride: ""
fullnameOverride: ""

serviceAccount:
  # Specifies whether a service account should be created
  create: true
  # The name of the service account to use.
  # If not set and create is true, a name is generated using the fullname template
  name:

rbac:
  # Specifies whether roles and bindings should be created
  enable: true

podSecurityContext: {}
  # fsGroup: 2000

securityContext: {}
  # capabilities:
  #   drop:
  #   - ALL
  # readOnlyRootFilesystem: true
  # runAsNonRoot: true
  # runAsUser: 1000

service:
  type: ClusterIP
  port: 80

serviceMonitor:
  enabled: false
  # specific labels for serviceMonitor
  # labels: {}

grafanaDashboard:
  enabled: false

resources: {}
  # requests:
  #   cpu: 1000m
  #   memory: 4096Mi
  # limits:
  #   cpu: 2000m
  #   memory: 8192Mi

nodeSelector: {}

tolerations: []

affinity: {}

# pass (additional) arguments to the container
extraArgs: []

# use to set extra environment variables
# NO_DBSYNC_VIA_TRIVY : set to true, this will avoid trivy db synch via trivy
#                       command. Useful for air-gapped environnement.
# TRIVY_FULL_DB : set to true if your DB is a full one in you air-gapped env.
# TRIVY_OFFLINE_SCAN : official Trivy envvar (since trivy 0.22.0) so it doesn't
#                      connect to external API (for jar and pom.xml).
extraEnv: {}

# use to add extra labels
extraLabels: {}

# use to add extra labels to podspec for getting their values in prometheus
extraPodLabels: {}

# use to overwrite default CA certificates with your own
# e.g :
# caCerts: |
#  ----- BEGIN CERTIFICATE -----
#  MIID7zCCAtegAwIBAgIBADANBgkqhkiG9w0BAQsFADCBmDELMAkGA1UEBhMCVVMx
#  EDA....
#  ...
#  ----- END CERTIFICATE -----
#  ----- BEGIN CERTIFICATE -----
#  .....
#  ----- END CERTIFICATE -----
#
# caCerts:

# use to set Trivy Cache directory location
trivyCacheDir: "/trivy-cache"

# Use to update trivy db by yourself, in case of air-gapped environment.
# This script is an example you can customize in values file, depending on
# your requirements.
# Please ensure NO_DBSYNC_VIA_TRIVY is true so estafette-vulnerability-scanner
# db updater won't run.
manualDbSync:
  enabled: false
  image: curlimages/curl:7.77.0
  imagePullPolicy: IfNotPresent
  script: [ '''
    cd $TRIVY_CACHE_DIR/tmp || exit ;
    while sleep 1200 ; do
      date ;
      curl --capath /etc/ssl/certs --silent --location $TRIVY_DB_URL | tar xz ;
      mv trivy*.db trivy.db ;
      mv $TRIVY_CACHE_DIR/tmp/* $TRIVY_CACHE_DIR/db/ ;
    done ;
  ''' ]
  resources: {}
    # requests:
    #   cpu: 1000m
    #   memory: 4096Mi
    # limits:
    #   cpu: 2000m
    #   memory: 8192Mi

  initcontainer:
    image: curlimages/curl:7.77.0
    imagePullPolicy: IfNotPresent
    script: ['''
      mkdir -p $TRIVY_CACHE_DIR/db $TRIVY_CACHE_DIR/tmp ;
      cd $TRIVY_CACHE_DIR/tmp || exit ;
      curl --capath /etc/ssl/certs --silent --location $TRIVY_DB_URL | tar xz ;
      mv trivy*.db trivy.db ;
      mv $TRIVY_CACHE_DIR/tmp/* $TRIVY_CACHE_DIR/db/ ;
    ''']
    resources: {}
      # requests:
      #   cpu: 1000m
      #   memory: 4096Mi
      # limits:
      #   cpu: 2000m
      #   memory: 8192Mi
